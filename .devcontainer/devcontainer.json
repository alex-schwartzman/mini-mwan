{
	"name": "Mini-MWAN OpenWRT Development",

	// Use the existing Dockerfile (one level up from .devcontainer/)
	"dockerFile": "../Dockerfile",

	// Workspace mount - mount repository root for access to both packages
	"workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind",
	"workspaceFolder": "/workspace",

	// Additional mounts for packages and build artifacts
	"mounts": [
		// Mount mini-mwan package (daemon) - read-write for development
		"source=${localWorkspaceFolder}/mini-mwan/files,target=/builder/package/mini-mwan/files,type=bind",
		"source=${localWorkspaceFolder}/mini-mwan/Makefile.devcontainer,target=/builder/package/mini-mwan/Makefile,type=bind",

		// Mount luci-app-mini-mwan package (LuCI interface) - read-write for development
		"source=${localWorkspaceFolder}/luci-app-mini-mwan/htdocs,target=/builder/package/luci-app-mini-mwan/htdocs,type=bind",
		"source=${localWorkspaceFolder}/luci-app-mini-mwan/root,target=/builder/package/luci-app-mini-mwan/root,type=bind",
		"source=${localWorkspaceFolder}/luci-app-mini-mwan/po,target=/builder/package/luci-app-mini-mwan/po,type=bind",
		"source=${localWorkspaceFolder}/luci-app-mini-mwan/Makefile.devcontainer,target=/builder/package/luci-app-mini-mwan/Makefile,type=bind",

		// Mount output directory for built packages
		"source=${localWorkspaceFolder}/bin,target=/builder/bin,type=bind",

		// Use named volumes for feeds (much faster than macOS filesystem)
		"source=mini-mwan-feeds,target=/builder/feeds,type=volume",
		"source=mini-mwan-dl,target=/builder/dl,type=volume"
	],

	// Set container user
	"remoteUser": "buildbot",

	// VS Code customizations
	"customizations": {
		"vscode": {
			"extensions": [
				// Lua language support for LuCI files
				"sumneko.lua",
				"actboy168.lua-debug",

				// Shell script support for .sh files
				"timonwong.shellcheck",
				"foxundermoon.shell-format",

				// General utilities
				"editorconfig.editorconfig",
				"streetsidesoftware.code-spell-checker"
			],
			"settings": {
				"terminal.integrated.defaultProfile.linux": "bash",
				"files.eol": "\n",
				"files.insertFinalNewline": true,
				"files.trimTrailingWhitespace": true,

				// Lua settings
				"Lua.diagnostics.globals": [
					"translate",
					"Map",
					"TypedSection",
					"Flag",
					"Value"
				],
				"Lua.workspace.library": [
					"/usr/share/lua"
				]
			}
		}
	},

	// Commands to run after container is created
	"postCreateCommand": "bash -c 'cd /builder && ./scripts/feeds update -a && ./scripts/feeds install -a'",

	// Keep container running
	"overrideCommand": true,

	// Forward ports if needed (optional)
	// "forwardPorts": [],

	// Features to add (optional - uncomment if needed)
	// "features": {
	// 	"ghcr.io/devcontainers/features/git:1": {}
	// }
}